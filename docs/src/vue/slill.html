<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue 实用骚操作了解一下 | hisey</title>
    <meta name="description" content="不一样的世界，等你去发现">
    <link rel="stylesheet" href="/front-end-doc/font/iconfont.css">
  <link rel="stylesheet" href="/front-end-doc/style/index.css">
    
    <link rel="preload" href="/front-end-doc/assets/css/0.styles.047a64fa.css" as="style"><link rel="preload" href="/front-end-doc/assets/js/app.47fd8e04.js" as="script"><link rel="preload" href="/front-end-doc/assets/js/25.922f5b3a.js" as="script"><link rel="prefetch" href="/front-end-doc/assets/js/1.80fa799c.js"><link rel="prefetch" href="/front-end-doc/assets/js/10.7787f290.js"><link rel="prefetch" href="/front-end-doc/assets/js/11.12573a5f.js"><link rel="prefetch" href="/front-end-doc/assets/js/12.6ffd070c.js"><link rel="prefetch" href="/front-end-doc/assets/js/13.3bffb7f0.js"><link rel="prefetch" href="/front-end-doc/assets/js/14.7d9360c3.js"><link rel="prefetch" href="/front-end-doc/assets/js/15.379c0b6f.js"><link rel="prefetch" href="/front-end-doc/assets/js/16.b5c28c25.js"><link rel="prefetch" href="/front-end-doc/assets/js/17.f0e220fd.js"><link rel="prefetch" href="/front-end-doc/assets/js/18.e4e6827d.js"><link rel="prefetch" href="/front-end-doc/assets/js/19.e120eb8c.js"><link rel="prefetch" href="/front-end-doc/assets/js/20.a7d446a4.js"><link rel="prefetch" href="/front-end-doc/assets/js/21.c6e5c6f6.js"><link rel="prefetch" href="/front-end-doc/assets/js/22.f3abc10e.js"><link rel="prefetch" href="/front-end-doc/assets/js/23.13df7863.js"><link rel="prefetch" href="/front-end-doc/assets/js/24.883a0aa1.js"><link rel="prefetch" href="/front-end-doc/assets/js/26.c4b50634.js"><link rel="prefetch" href="/front-end-doc/assets/js/27.dfd8a756.js"><link rel="prefetch" href="/front-end-doc/assets/js/28.a0512ec7.js"><link rel="prefetch" href="/front-end-doc/assets/js/3.c88ea40f.js"><link rel="prefetch" href="/front-end-doc/assets/js/4.dd026023.js"><link rel="prefetch" href="/front-end-doc/assets/js/5.27760a19.js"><link rel="prefetch" href="/front-end-doc/assets/js/6.47ca6ee2.js"><link rel="prefetch" href="/front-end-doc/assets/js/7.4655b2ef.js"><link rel="prefetch" href="/front-end-doc/assets/js/8.135b63aa.js"><link rel="prefetch" href="/front-end-doc/assets/js/9.1c04ae80.js">
    <link rel="stylesheet" href="/front-end-doc/assets/css/0.styles.047a64fa.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/front-end-doc/" class="home-link router-link-active"><!----> <span class="site-name">hisey</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/front-end-doc/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Git指南</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-doc/src/base/git/flow.html" class="nav-link">Git工作流</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/base/git/bash.html" class="nav-link">常用命令行</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-doc/src/base/codeStyle/" class="nav-link">es6代码风格</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/base/cssDoc/" class="nav-link">css干货</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/base/jsDoc/" class="nav-link">js干货</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/base/flexbox/" class="nav-link">弹性盒子布局</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">解决方案</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-doc/src/case/webSplit/" class="nav-link">前后端分离</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/case/autoDeploy/" class="nav-link">代码部署</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/case/websocket/" class="nav-link">websocket</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-doc/src/smallProgram/mpvue/" class="nav-link">mpvue搭建小程序</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-doc/src/vue/" class="nav-link router-link-active">基础</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/vue/vueCompont/" class="nav-link">组件示例</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/vue/debug.html" class="nav-link">断点调试</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/vue/elegant.html" class="nav-link">优雅写法</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/vue/slill.html" class="nav-link router-link-exact-active router-link-active">实用骚操作</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/vue/standards.html" class="nav-link">代码规范</a></li></ul></div></div><div class="nav-item"><a href="/front-end-doc/src/favorites/" class="nav-link">收藏夹</a></div><div class="nav-item"><a href="/front-end-doc/src/aboutMe/" class="nav-link">关于我</a></div> <a href="https://github.com//hisey/front-end-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    gitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/front-end-doc/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Git指南</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-doc/src/base/git/flow.html" class="nav-link">Git工作流</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/base/git/bash.html" class="nav-link">常用命令行</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-doc/src/base/codeStyle/" class="nav-link">es6代码风格</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/base/cssDoc/" class="nav-link">css干货</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/base/jsDoc/" class="nav-link">js干货</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/base/flexbox/" class="nav-link">弹性盒子布局</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">解决方案</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-doc/src/case/webSplit/" class="nav-link">前后端分离</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/case/autoDeploy/" class="nav-link">代码部署</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/case/websocket/" class="nav-link">websocket</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">小程序</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-doc/src/smallProgram/mpvue/" class="nav-link">mpvue搭建小程序</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">vue</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/front-end-doc/src/vue/" class="nav-link router-link-active">基础</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/vue/vueCompont/" class="nav-link">组件示例</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/vue/debug.html" class="nav-link">断点调试</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/vue/elegant.html" class="nav-link">优雅写法</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/vue/slill.html" class="nav-link router-link-exact-active router-link-active">实用骚操作</a></li><li class="dropdown-item"><!----> <a href="/front-end-doc/src/vue/standards.html" class="nav-link">代码规范</a></li></ul></div></div><div class="nav-item"><a href="/front-end-doc/src/favorites/" class="nav-link">收藏夹</a></div><div class="nav-item"><a href="/front-end-doc/src/aboutMe/" class="nav-link">关于我</a></div> <a href="https://github.com//hisey/front-end-doc" target="_blank" rel="noopener noreferrer" class="repo-link">
    gitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Vue 实用骚操作了解一下</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/front-end-doc/src/vue/slill.html#_1-多图表resize事件去中心化" class="sidebar-link">1. 多图表resize事件去中心化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_1-1-一般情况" class="sidebar-link">1.1 一般情况</a></li><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_1-2-优化" class="sidebar-link">1.2 优化</a></li><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_1-3-再次优化" class="sidebar-link">1.3 再次优化</a></li></ul></li><li><a href="/front-end-doc/src/vue/slill.html#_2-全局过滤器注册" class="sidebar-link">2. 全局过滤器注册</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_2-1-一般情况" class="sidebar-link">2.1 一般情况</a></li><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_2-2-优化" class="sidebar-link">2.2 优化</a></li></ul></li><li><a href="/front-end-doc/src/vue/slill.html#_3-全局组件注册" class="sidebar-link">3. 全局组件注册</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_3-1-一般情况" class="sidebar-link">3.1 一般情况</a></li><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_3-2-优化" class="sidebar-link">3.2 优化</a></li></ul></li><li><a href="/front-end-doc/src/vue/slill.html#_4-不同路由的组件复用" class="sidebar-link">4. 不同路由的组件复用</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_4-1-场景还原" class="sidebar-link">4.1 场景还原</a></li><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_4-2-优化" class="sidebar-link">4.2 优化</a></li></ul></li><li><a href="/front-end-doc/src/vue/slill.html#_5-组件事件属性穿透" class="sidebar-link">5. 组件事件属性穿透</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_5-1-一般情况" class="sidebar-link">5.1 一般情况</a></li><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_5-2-优化" class="sidebar-link">5.2 优化</a></li></ul></li><li><a href="/front-end-doc/src/vue/slill.html#_6-路由根据开发状态懒加载" class="sidebar-link">6. 路由根据开发状态懒加载</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_6-1-一般情况" class="sidebar-link">6.1 一般情况</a></li><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_6-2-优化" class="sidebar-link">6.2 优化</a></li></ul></li><li><a href="/front-end-doc/src/vue/slill.html#_7-vue-loader小技巧" class="sidebar-link">7. vue-loader小技巧</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_7-1-用-preservewhitespace-减少文件体积" class="sidebar-link">7.1 用 preserveWhitespace 减少文件体积</a></li><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_7-2-使用-transformtorequire-再也不用把图片写成变量了" class="sidebar-link">7.2 使用 transformToRequire 再也不用把图片写成变量了</a></li></ul></li><li><a href="/front-end-doc/src/vue/slill.html#_8-render-函数" class="sidebar-link">8. render 函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front-end-doc/src/vue/slill.html#_8-1-动态标签" class="sidebar-link">8.1 动态标签</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="vue-实用骚操作了解一下"><a href="#vue-实用骚操作了解一下" aria-hidden="true" class="header-anchor">#</a> Vue 实用骚操作了解一下</h1> <p>在Vue的使用过程中会遇到各种场景，当普通使用时觉得没什么，但是或许优化一下可以更高效更优美地进行开发。下面有一些我在日常开发的时候用到的小技巧。</p> <h2 id="_1-多图表resize事件去中心化"><a href="#_1-多图表resize事件去中心化" aria-hidden="true" class="header-anchor">#</a> 1. 多图表resize事件去中心化</h2> <h3 id="_1-1-一般情况"><a href="#_1-1-一般情况" aria-hidden="true" class="header-anchor">#</a> 1.1 一般情况</h3> <p>有时候我们会遇到这样的场景，一个组件中有几个图表，在浏览器 resize 的时候我们希望图表也进行 resize，因此我们会在 父容器组件中写：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> window<span class="token punctuation">.</span><span class="token function-variable function">onresize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>chart1<span class="token punctuation">.</span>chartWrapperDom<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>chart2<span class="token punctuation">.</span>chartWrapperDom<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// ... </span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span>
<span class="token function">destroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> window<span class="token punctuation">.</span>onresize <span class="token operator">=</span> <span class="token keyword">null</span> <span class="token punctuation">}</span>
</code></pre></div><p>这样子图表组件如果跟父容器组件不在一个页面，子组件的状态就被放到父组件进行管理。为了维护方便，我们自然希望子组件的事件和状态由自己来维护，这样在添加删除组件的时候就不需要去父组件挨个修改。</p> <h3 id="_1-2-优化"><a href="#_1-2-优化" aria-hidden="true" class="header-anchor">#</a> 1.2 优化</h3> <p>这里使用了 lodash 的节流 throttle 函数，也可以自己实现，这篇文章也有节流的实现可以参考一下。以 Echarts 为例，在每个图表组件中：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * 图表DOM
   */</span>
  <span class="token function">chartWrapperDom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'consume-analy-chart-wrapper'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> dom <span class="token operator">&amp;&amp;</span> Echarts<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/**
   * 图表resize节流，这里使用了lodash，也可以自己使用setTimout实现节流
   */</span>
  <span class="token function">chartResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">throttle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chartWrapperDom <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chartWrapperDom<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chartResize<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token function">destroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>chartResize<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_1-3-再次优化"><a href="#_1-3-再次优化" aria-hidden="true" class="header-anchor">#</a> 1.3 再次优化</h3> <p>感谢 @JserWang 的提醒，这里因为多个 chart 实例都使用同一套初始化逻辑，可以使用 extends 来考虑复用，因此我想到了 Vue 提供的 Mixins，所以我在这里做了点优化，可以让每个同类型的 chart 组件更优雅一点，新建一个 mixin.js 文件：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Echarts <span class="token keyword">from</span> <span class="token string">'echarts'</span>
<span class="token keyword">import</span> _ <span class="token keyword">from</span> <span class="token string">'lodash'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 图表DOM */</span>
    <span class="token function">$_chartMixin_chartWrapperDom</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>thisDomId<span class="token punctuation">)</span>
      <span class="token keyword">return</span> dom <span class="token operator">&amp;&amp;</span> Echarts<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">/** 图表resize节流，这里使用了lodash，也可以自己使用setTimout实现节流 */</span>
    <span class="token function">$_chartMixin_chartResize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> _<span class="token punctuation">.</span><span class="token function">throttle</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$_chartMixin_chartWrapperDom<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">400</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token comment">/* 图表初始化 */</span>
    <span class="token function">$_chartMixin_initChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>$_chartMixin_chartWrapperDom<span class="token punctuation">.</span><span class="token function">setOption</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token comment">/* options */</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$_chartMixin_initChart</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$_chartMixin_chartResize<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">destroyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">removeEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$_chartMixin_chartResize<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>然后在每个 chart 组件中：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span>
<span class="token keyword">import</span> ChartMixin <span class="token keyword">from</span> <span class="token string">'./mixin'</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  mixins<span class="token punctuation">:</span> <span class="token punctuation">[</span>ChartMixin<span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      thisDomId<span class="token punctuation">:</span> <span class="token string">'consume-analy-chart-wrapper'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>这样就可以在每个图表组件中混入之前在 mixin.js 中定义的 resize 事件逻辑，且自动初始化，并在 destroyed 的时候自动销毁事件。</p> <p>当然可以进一步优化一下，比如一个页面有多个图表的话，上面的实现就力有不逮了，这里需要重构一下，具体代码可以参照 chartInitMixin - GitHub 的实现。</p> <h2 id="_2-全局过滤器注册"><a href="#_2-全局过滤器注册" aria-hidden="true" class="header-anchor">#</a> 2. 全局过滤器注册</h2> <h3 id="_2-1-一般情况"><a href="#_2-1-一般情况" aria-hidden="true" class="header-anchor">#</a> 2.1 一般情况</h3> <p>官方注册过滤器的方式：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  filters<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token function">orderBy</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// doSomething</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">uppercase</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// doSomething</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>但是对我们做项目来说，大部分的过滤器是要全局使用的，不会每每用到就在组件里面去写，抽成全局的会更好些。官方注册全局的方式：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 注册</span>
Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'my-filter'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 返回处理后的值</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// getter，返回已注册的过滤器</span>
<span class="token keyword">var</span> myFilter <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token string">'my-filter'</span><span class="token punctuation">)</span>
</code></pre></div><p>但是分散写的话不美观，因此可以抽出成单独文件。</p> <h3 id="_2-2-优化"><a href="#_2-2-优化" aria-hidden="true" class="header-anchor">#</a> 2.2 优化</h3> <p>我们可以抽出到独立文件，然后使用 Object.keys 在 main.js 入口统一注册：
/src/common/filters.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">let</span> <span class="token function-variable function">dateServer</span> <span class="token operator">=</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/(\d{4})(\d{2})(\d{2})/g</span><span class="token punctuation">,</span> <span class="token string">'$1-$2-$3'</span><span class="token punctuation">)</span> 

<span class="token keyword">export</span> <span class="token punctuation">{</span> dateServer <span class="token punctuation">}</span>
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>/src/main.js
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> custom <span class="token keyword">from</span> <span class="token string">'./common/filters/custom'</span>
Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>custom<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> Vue<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> custom<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p>然后在其他的 .vue 文件中就可愉快地使用这些我们定义好的全局过滤器了。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>section <span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;content&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span> time <span class="token operator">|</span> dateServer <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token number">2016</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">01</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>section<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        time<span class="token punctuation">:</span> <span class="token number">20160101</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><h2 id="_3-全局组件注册"><a href="#_3-全局组件注册" aria-hidden="true" class="header-anchor">#</a> 3. 全局组件注册</h2> <h3 id="_3-1-一般情况"><a href="#_3-1-一般情况" aria-hidden="true" class="header-anchor">#</a> 3.1 一般情况</h3> <p>需要使用组件的场景：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>BaseInput  v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">&quot;searchText&quot;</span>  @keydown<span class="token punctuation">.</span>enter<span class="token operator">=</span><span class="token string">&quot;search&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>BaseButton @click<span class="token operator">=</span><span class="token string">&quot;search&quot;</span><span class="token operator">&gt;</span>
        <span class="token operator">&lt;</span>BaseIcon name<span class="token operator">=</span><span class="token string">&quot;search&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>BaseButton<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
    <span class="token keyword">import</span> BaseButton <span class="token keyword">from</span> <span class="token string">'./baseButton'</span>
    <span class="token keyword">import</span> BaseIcon <span class="token keyword">from</span> <span class="token string">'./baseIcon'</span>
    <span class="token keyword">import</span> BaseInput <span class="token keyword">from</span> <span class="token string">'./baseInput'</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
      components<span class="token punctuation">:</span> <span class="token punctuation">{</span> BaseButton<span class="token punctuation">,</span> BaseIcon<span class="token punctuation">,</span> BaseInput <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>我们写了一堆基础 UI 组件，然后每次我们需要使用这些组件的时候，都得先 import，然后声明 components，很繁琐，这里可以使用统一注册的形式。</p> <h3 id="_3-2-优化"><a href="#_3-2-优化" aria-hidden="true" class="header-anchor">#</a> 3.2 优化</h3> <p>我们需要借助一下神器 webpack，使用 require.context() 方法来创建自己的模块上下文，从而实现自动动态 require 组件。这个方法需要 3 个参数：要搜索的文件夹目录、是否还应该搜索它的子目录、以及一个匹配文件的正则表达式。我们在 components 文件夹添加一个叫 componentRegister .js 的文件，在这个文件里借助 webpack 动态将需要的基础组件统统打包进来。</p> <div class="language- extra-class"><pre class="language-text"><code>/src/components/ componentRegister .js
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token comment">/**
 * 首字母大写
 * @param str 字符串
 * @example heheHaha
 * @return {string} HeheHaha
 */</span>
<span class="token keyword">function</span> <span class="token function">capitalizeFirstLetter</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> str<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 对符合'xx/xx.vue'组件格式的组件取组件名
 * @param str fileName
 * @example abc/bcd/def/basicTable.vue
 * @return {string} BasicTable
 */</span>
<span class="token keyword">function</span> <span class="token function">validateFileName</span><span class="token punctuation">(</span><span class="token parameter">str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">/</span><span class="token operator">^</span>\<span class="token constant">S</span><span class="token operator">+</span>\<span class="token punctuation">.</span>vue$<span class="token operator">/</span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
    str<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/^\S+\/(\w+)\.vue$/</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">rs<span class="token punctuation">,</span> $<span class="token number">1</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">capitalizeFirstLetter</span><span class="token punctuation">(</span>$<span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> requireComponent <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex">/\.vue$/</span><span class="token punctuation">)</span>

<span class="token comment">// 找到组件文件夹下以.vue命名的文件，如果文件名为index，那么取组件中的name作为注册的组件名</span>
requireComponent<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">filePath</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> componentConfig <span class="token operator">=</span> <span class="token function">requireComponent</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
  <span class="token keyword">const</span> fileName <span class="token operator">=</span> <span class="token function">validateFileName</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span>
  <span class="token keyword">const</span> componentName <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">toLowerCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'index'</span>
    <span class="token operator">?</span> <span class="token function">capitalizeFirstLetter</span><span class="token punctuation">(</span>componentConfig<span class="token punctuation">.</span>default<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">:</span> fileName
  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span>componentName<span class="token punctuation">,</span> componentConfig<span class="token punctuation">.</span>default <span class="token operator">||</span> componentConfig<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这里文件夹结构：</p> <div class="language- extra-class"><pre class="language-text"><code>components
│ componentRegister.js
├─BasicTable
│ BasicTable.vue
├─MultiCondition
│ index.vue
</code></pre></div><p>这里对组件名做了判断，如果是 index 的话就取组件中的 name 属性处理后作为注册组件名， 所以最后注册的组件为：multi-condition、 basic-table 最后我们在 main.js 中 import 'components/ componentRegister .js'，然后我们就可以随时随地使用这些基础组件，无需手动引入了。</p> <h2 id="_4-不同路由的组件复用"><a href="#_4-不同路由的组件复用" aria-hidden="true" class="header-anchor">#</a> 4. 不同路由的组件复用</h2> <h3 id="_4-1-场景还原"><a href="#_4-1-场景还原" aria-hidden="true" class="header-anchor">#</a> 4.1 场景还原</h3> <p>当某个场景中 vue-router从/post-page/a，跳转到 /post-page/b。然后我们惊人地发现，页面跳转后数据竟然没更新？！原因是 vue-router &quot;智能地&quot;发现这是同一个组件，然后它就决定要复用这个组件，所以你在 created 函数里写的方法压根就没执行。通常的解决方案是监听 $route 的变化来初始化数据，如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    loading<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    error<span class="token punctuation">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
    post<span class="token punctuation">:</span> <span class="token keyword">null</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
watch<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token string">'$route'</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>        <span class="token comment">// 使用watch来监控是否是同一个路由</span>
    handler<span class="token punctuation">:</span> <span class="token string">'resetData'</span><span class="token punctuation">,</span>
    immediate<span class="token punctuation">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token function">resetData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loading <span class="token operator">=</span> <span class="token boolean">false</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>error <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>post <span class="token operator">=</span> <span class="token keyword">null</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getPost</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$route<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">getPost</span><span class="token punctuation">(</span><span class="token parameter">id</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="_4-2-优化"><a href="#_4-2-优化" aria-hidden="true" class="header-anchor">#</a> 4.2 优化</h3> <p>为了实现这样的效果可以给 router-view添加一个不同的 key，这样即使是公用组件，只要 url 变化了，就一定会重新创建这个组件。</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;router-view :key=&quot;$route.fullpath&quot;&gt;&lt;/router-view&gt;
</code></pre></div><p>还可以在其后加 ++newDate()时间戳，保证独一无二。</p> <p>感谢网友 @rolitter 的提醒，如果组件被放在 &quot;keep-Alive&quot;中的话，可以把获取新数据的方法放在 activated 钩子，代替原来在 created、mounted 钩子中获取数据的任务。</p> <h2 id="_5-组件事件属性穿透"><a href="#_5-组件事件属性穿透" aria-hidden="true" class="header-anchor">#</a> 5. 组件事件属性穿透</h2> <h3 id="_5-1-一般情况"><a href="#_5-1-一般情况" aria-hidden="true" class="header-anchor">#</a> 5.1 一般情况</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 父组件</span>

<span class="token operator">&lt;</span>BaseInput <span class="token punctuation">:</span>value<span class="token operator">=</span><span class="token string">&quot;value&quot;</span>
           label<span class="token operator">=</span><span class="token string">&quot;密码&quot;</span>
           placeholder<span class="token operator">=</span><span class="token string">&quot;请填写密码&quot;</span>
           @input<span class="token operator">=</span><span class="token string">&quot;handleInput&quot;</span>
           @focus<span class="token operator">=</span><span class="token string">&quot;handleFocus&quot;</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>BaseInput<span class="token operator">&gt;</span>
</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 子组件</span>
<span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>label<span class="token operator">&gt;</span>
    <span class="token punctuation">{</span><span class="token punctuation">{</span> label <span class="token punctuation">}</span><span class="token punctuation">}</span>
    <span class="token operator">&lt;</span>input <span class="token punctuation">:</span>value<span class="token operator">=</span><span class="token string">&quot; value&quot;</span>
           <span class="token punctuation">:</span>placeholder<span class="token operator">=</span><span class="token string">&quot;placeholder&quot;</span>
           @focus<span class="token operator">=</span><span class="token string">&quot;$emit('focus', $event)&quot;</span>
           @input<span class="token operator">=</span><span class="token string">&quot;$emit('input', $event.target.value)&quot;</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>label<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre></div><h3 id="_5-2-优化"><a href="#_5-2-优化" aria-hidden="true" class="header-anchor">#</a> 5.2 优化</h3> <p>Vue 的组件实例中的 $props、 $attrs给我们提供了很大的便利，特别是父子组件传值的时候。</p> <p>（1）每一个从父组件传到子组件的 props，我们都得在子组件的 Props 中显式的声明才能使用。这样一来，我们的子组件每次都需要申明一大堆 props，这里我们知道 v-bind 是可以传对象 的，可以在 vm.$props 中拿到所有父组件props的值 v-bind=&quot;$props&quot;。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>input  v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">&quot;$props&quot;</span> 
       @input<span class="token operator">=</span><span class="token string">&quot;$emit('input', $event.target.value)&quot;</span><span class="token operator">&gt;</span>
</code></pre></div><p>（2）类似 placeholer 这种 dom 原生的 property 可以使用 $attrs 直接从父传到子，无需声明。方法如下：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>input <span class="token punctuation">:</span>value<span class="token operator">=</span><span class="token string">&quot;value&quot;</span>
       v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">&quot;$attrs&quot;</span>
       @input<span class="token operator">=</span><span class="token string">&quot;$emit('input', $event.target.value)&quot;</span><span class="token operator">&gt;</span>
</code></pre></div><p>$attrs 包含了父作用域中不作为 prop 被识别 (且获取) 的特性绑定 (class 和 style 除外)。当一个组件没有声明任何 prop 时，这里会包含所有父作用域的绑定，并且可以通过 v-bind=&quot;$attrs&quot;传入内部组件。</p> <p>（3） 注意到子组件的 @focus=&quot;$emit('focus', $event)&quot;其实什么都没做，只是把 event 传回给父组件而已，那其实和上面类似，完全没必要显式地申明：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>input <span class="token punctuation">:</span>value<span class="token operator">=</span><span class="token string">&quot;value&quot;</span>
       v<span class="token operator">-</span>bind<span class="token operator">=</span><span class="token string">&quot;$attrs&quot;</span>
       v<span class="token operator">-</span>on<span class="token operator">=</span><span class="token string">&quot;listeners&quot;</span><span class="token operator">/</span><span class="token operator">&gt;</span>

computed<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  <span class="token function">listeners</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>
      <span class="token operator">...</span>this<span class="token punctuation">.</span>$listeners<span class="token punctuation">,</span>
      <span class="token function-variable function">input</span><span class="token punctuation">:</span> <span class="token parameter">event</span> <span class="token operator">=&gt;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">,</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>value<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>$listeners包含了父作用域中的 (不含 .native 修饰器的) v-on 事件监听器。它可以通过 v-on=&quot;$listeners&quot; 传入内部组件——在创建更高层次的组件时非常有用。</p> <p>需要注意的是，由于我们 input 并不是 BaseInput 这个组件的根节点，而默认情况下父作用域的不被认作 props的特性绑定将会“回退”且作为普通的 HTML 特性应用在子组件的根元素上。所以我们需要设置 inheritAttrs:false，这些默认行为将会被去掉，上面优化才能成功。</p> <h2 id="_6-路由根据开发状态懒加载"><a href="#_6-路由根据开发状态懒加载" aria-hidden="true" class="header-anchor">#</a> 6. 路由根据开发状态懒加载</h2> <h3 id="_6-1-一般情况"><a href="#_6-1-一般情况" aria-hidden="true" class="header-anchor">#</a> 6.1 一般情况</h3> <p>一般我们在路由中加载组件的时候：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">import</span> Login <span class="token keyword">from</span> <span class="token string">'@/views/login.vue'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'登陆'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> Login<span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>当你需要懒加载 lazy-loading 的时候，需要一个个把 routes 的 component 改为 ()=&gt;import('@/views/login.vue')，甚为麻烦。</p> <p>当你的项目页面越来越多之后，在开发环境之中使用 lazy-loading 会变得不太合适，每次更改代码触发热更新都会变得非常的慢。所以建议只在生成环境之中使用路由懒加载功能。</p> <h3 id="_6-2-优化"><a href="#_6-2-优化" aria-hidden="true" class="header-anchor">#</a> 6.2 优化</h3> <p>根据 Vue 的异步组件和 Webpack 的代码分割功能可以轻松实现组件的懒加载，如：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">Foo</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./Foo.vue'</span><span class="token punctuation">)</span>
</code></pre></div><p>在区分开发环境与生产环境时，可以在路由文件夹下分别新建两个文件：</p> <p>_import_production.js</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'@/views/'</span> <span class="token operator">+</span> file <span class="token operator">+</span> <span class="token string">'.vue'</span><span class="token punctuation">)</span>
</code></pre></div><p>_import_development.js (这种写法 vue-loader版本至少v13.0.0以上)</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">file</span> <span class="token operator">=&gt;</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@/views/'</span> <span class="token operator">+</span> file <span class="token operator">+</span> <span class="token string">'.vue'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default
</code></pre></div><p>而在设置路由的 router/index.js文件中：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> _import <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./_import_'</span> <span class="token operator">+</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> path<span class="token punctuation">:</span> <span class="token string">'/login'</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">'登陆'</span><span class="token punctuation">,</span> component<span class="token punctuation">:</span> <span class="token function">_import</span><span class="token punctuation">(</span><span class="token string">'login/index'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p>这样组件在开发环境下就是非懒加载，生产环境下就是懒加载的了。</p> <h2 id="_7-vue-loader小技巧"><a href="#_7-vue-loader小技巧" aria-hidden="true" class="header-anchor">#</a> 7. vue-loader小技巧</h2> <p>vue-loader 是处理 *.vue 文件的 webpack loader。它本身提供了丰富的 API，有些 API 很实用但很少被人熟知。例如接下来要介绍的 preserveWhitespace 和 transformToRequire</p> <h3 id="_7-1-用-preservewhitespace-减少文件体积"><a href="#_7-1-用-preservewhitespace-减少文件体积" aria-hidden="true" class="header-anchor">#</a> 7.1 用 preserveWhitespace 减少文件体积</h3> <p>有些时候我们在写模板时不想让元素和元素之间有空格，可能会写成这样：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>1111<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>2222<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">&gt;</span></span>333<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>当然还有其他方式，比如设置字体的 font-size:0，然后给需要的内容单独设置字体大小，目的是为了去掉元素间的空格。其实我们完全可以通过配置 vue-loader 实现这一需求。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  vue<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    preserveWhitespace<span class="token punctuation">:</span> <span class="token boolean">false</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>它的作用是阻止元素间生成空白内容，在 Vue 模板编译后使用 _v(&quot; &quot;) 表示。如果项目中模板内容多的话，它们还是会占用一些文件体积的。例如 Element 配置该属性后，未压缩情况下文件体积减少了近 30Kb。</p> <h3 id="_7-2-使用-transformtorequire-再也不用把图片写成变量了"><a href="#_7-2-使用-transformtorequire-再也不用把图片写成变量了" aria-hidden="true" class="header-anchor">#</a> 7.2 使用 transformToRequire 再也不用把图片写成变量了</h3> <p>以前在写 Vue 的时候经常会写到这样的代码：把图片提前 require 传给一个变量再传给组件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>avatar <span class="token punctuation">:</span><span class="token keyword">default</span><span class="token operator">-</span>src<span class="token operator">=</span><span class="token string">&quot;DEFAULT_AVATAR&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>avatar<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token constant">DEFAULT_AVATAR</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./assets/default-avatar.png'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>其实通过配置 transformToRequire 后，就可以直接配置，这样 vue-loader 会把对应的属性自动 require 之后传给组件。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token punctuation">{</span>
  vue<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    transformToRequire<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      avatar<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'default-src'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>于是我们代码就可以简化不少。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>avatar <span class="token keyword">default</span><span class="token operator">-</span>src<span class="token operator">=</span><span class="token string">&quot;./assets/default-avatar.png&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>avatar<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre></div><p>在 vue-cli 的 webpack 模板下，默认配置是：</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>transformToRequire<span class="token punctuation">:</span> <span class="token punctuation">{</span>
  video<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'src'</span><span class="token punctuation">,</span> <span class="token string">'poster'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  source<span class="token punctuation">:</span> <span class="token string">'src'</span><span class="token punctuation">,</span>
  img<span class="token punctuation">:</span> <span class="token string">'src'</span><span class="token punctuation">,</span>
  image<span class="token punctuation">:</span> <span class="token string">'xlink:href'</span>
<span class="token punctuation">}</span>
</code></pre></div><p>可以举一反三进行一下类似的配置。</p> <p>vue-loader 还有很多实用的 API 例如最近加入的 自定义块，感兴趣的各位可以去文档里找找看。</p> <h2 id="_8-render-函数"><a href="#_8-render-函数" aria-hidden="true" class="header-anchor">#</a> 8. render 函数</h2> <p>在某些场景下你可能需要 render 渲染函数带来的完全编程能力来解决不太容易解决的问题，特别是要动态选择生成标签和组件类型的场景。</p> <h3 id="_8-1-动态标签"><a href="#_8-1-动态标签" aria-hidden="true" class="header-anchor">#</a> 8.1 动态标签</h3> <h4 id="（1）一般情况"><a href="#（1）一般情况" aria-hidden="true" class="header-anchor">#</a> （1）一般情况</h4> <p>比如根据 props 来生成标签的场景。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div v<span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;level === 1&quot;</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;level === 2&quot;</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1 v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;level === 3&quot;</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h2 v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;level === 4&quot;</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>strong v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;level === 5&quot;</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>stong<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>textarea v<span class="token operator">-</span><span class="token keyword">else</span><span class="token operator">-</span><span class="token keyword">if</span><span class="token operator">=</span><span class="token string">&quot;level === 6&quot;</span><span class="token operator">&gt;</span> <span class="token operator">&lt;</span>slot<span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>slot<span class="token operator">&gt;</span> <span class="token operator">&lt;</span><span class="token operator">/</span>textarea<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>
</code></pre></div><p>其中 level 是 data 中的变量，可以看到这里有大量重复代码，如果逻辑复杂点，加上一些绑定和判断就更复杂了，这里可以利用 render 函数来对要生成的标签加以判断。</p> <h4 id="（2）优化"><a href="#（2）优化" aria-hidden="true" class="header-anchor">#</a> （2）优化</h4> <p>使用 render 方法根据参数来生成对应标签可以避免上面的情况。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>child <span class="token punctuation">:</span>level<span class="token operator">=</span><span class="token string">&quot;level&quot;</span><span class="token operator">&gt;</span>Hello world<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>child<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span>
  <span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'child'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> tag <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token string">'strong'</span><span class="token punctuation">,</span> <span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token string">'h2'</span><span class="token punctuation">,</span> <span class="token string">'textarea'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>level<span class="token punctuation">]</span>
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      level<span class="token punctuation">:</span> <span class="token punctuation">{</span>  type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span>  required<span class="token punctuation">:</span> <span class="token boolean">true</span>  <span class="token punctuation">}</span> 
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>   
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'hehe'</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> level<span class="token punctuation">:</span> <span class="token number">3</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div><p>示例可以查看 CodePen（https://codepen.io/SHERlocked93/pen/mLEJPE）。
8.2 动态组件
当然 render 函数还有很多用法，比如要使用动态组件，除了使用 :is 之外也可以使用 render 函数。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token operator">&lt;</span>template<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">'level = 0'</span><span class="token operator">&gt;</span>嘻嘻<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button @click<span class="token operator">=</span><span class="token string">'level = 1'</span><span class="token operator">&gt;</span>哈哈<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>hr<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>child <span class="token punctuation">:</span>level<span class="token operator">=</span><span class="token string">&quot;level&quot;</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>child<span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>template<span class="token operator">&gt;</span>

<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">'text/javascript'</span><span class="token operator">&gt;</span>
  <span class="token keyword">import</span> Vue <span class="token keyword">from</span> <span class="token string">'vue'</span>
  <span class="token keyword">import</span> Xixi <span class="token keyword">from</span> <span class="token string">'./Xixi'</span>
  <span class="token keyword">import</span> Haha <span class="token keyword">from</span> <span class="token string">'./Haha'</span>
  Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">'child'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> tag <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'xixi'</span><span class="token punctuation">,</span> <span class="token string">'haha'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>level<span class="token punctuation">]</span>
      <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>tag<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span> level<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Number<span class="token punctuation">,</span> required<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    components<span class="token punctuation">:</span> <span class="token punctuation">{</span> Xixi<span class="token punctuation">,</span> Haha <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token string">'hehe'</span><span class="token punctuation">,</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token punctuation">{</span> level<span class="token punctuation">:</span> <span class="token number">0</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">11/13/2019, 11:31:59 AM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/front-end-doc/assets/js/app.47fd8e04.js" defer></script><script src="/front-end-doc/assets/js/25.922f5b3a.js" defer></script>
  </body>
</html>
