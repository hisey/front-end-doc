# webview问题集锦
### 微信登陆后，如何把身份传给h5
方案：这个问题比较简单，在webview的url字符串上传递就是了。迅速解决，这种feel很nice啊
但要注意，当小程序从后台模式切换到前台模式时，在onshow里要进行身份的有效性检查
### 小程序cookie和微信共享，切到后台不丢失
问题：  
第一个页面开发完和后台接口联调的时候，突然发现token有问题（为了前后交互安全，基于OAuth实现的令牌）。

我们的h5网站也是可以微信浏览器访问的，但发放的token和小程序的是有差异性的。反反复复折腾了两天，才知道小程序的cookie和微信共享，而且后台运行时依然保留。
方案：进入时判断是否小程序，是的话全部清理token，重新获取，保证cookie数据的一致性
### 判断是否小程序内运行
方案：小程序webview的url加个参数&isSP=true，程序里判断一把就ok了。绿色环保无污染
### 高德地图的优化加载
按照标准的方式，在head里加入高德script，会有什么问题呢？
问题：  
1，h5页面反复跳转或返回，高德地图多次加载   
2，高德地图的响应不稳定。慢的时候会阻塞整个页面的渲染。  
因为高德地图在首页，我们想尽快的给用户显示内容，以避免客户流失。  
方案如下：  
1，preload高德地图js  
2，在使用的时候，通过createElement+appendChild的方法，进行懒加载。  
3，缓存高德地图对象，再次进入页面如果存在地图对象，不进行2的操作  
最终效果：客户会先看到头部和底部内容，高德地图慢慢显示。体验有所提高  
### webview间sessionStorage数据不共享
这个问题的痛点不在于如何解决。方案可以用cookie或localstoreage来替代。  
重点是不知道！不知道！不知道！  
